var Keyboard=function(){function e(t,a,s){var r=this,n=document.createElement("div");n.id="kb-base",n.classList.add("kb-base");for(var i=0;4>i;i++){var o=document.createElement("div");o.classList.add("kb-row"),n.appendChild(o)}this._editorElement=t,this._addSwitchKey=s.length>1,this._languages=s,this._languageIndex=0;var l=function(e){if(e.target!==e.currentTarget){var t=e.target;if("touchstart"==e.type||"mousedown"==e.type){e.preventDefault(),t.classList.add("kb-pressed");var a=t.getAttribute("data-handler");a&&"backspace"==a&&(r._isKeyPressed=!0,r._setPressedInterval(300,a,t))}else if("touchend"==e.type||"mouseup"==e.type){t.classList.remove("kb-pressed"),r._isKeyPressed&&(clearInterval(r._pressedHandle),r._isKeyPressed=!1,r._pressedHandle=null);var s=t.getAttribute("data-handler"),n=s?s:t.innerText;r._handleKey(n,t)}}e.stopPropagation()},d="ontouchstart"in window;d?(n.addEventListener("touchstart",l,!1),n.addEventListener("touchend",l,!1)):(n.addEventListener("mousedown",l,!1),n.addEventListener("mouseup",l,!1)),document.body.appendChild(n),this._baseElement=n,this._setKeymap(e._keymaps[0],!1,!1),this._populateLastRow(),a&&this._editorElement.style.setProperty("white-space","pre-wrap"),this._editorElement.focus()}return e.prototype._populate=function(e,t,a){var s;s=t?e.keys.numbers:a?e.keys.uppercase:e.keys.lowercase;for(var r=this._baseElement.querySelectorAll(".kb-row"),n=e.custom_styles,i=e.font,o=0,l=0,d=0;3>d;d++)for(r[d].innerHTML=null,o=0;o<e.rowLengths[d];o++){var u=s[l++],h=document.createElement("div");if(h.classList.add("kb-key","char"),n&&n.length>0){var p=n.filter(function(e){return e["char"]==u})[0];for(var c in p)"char"!=c&&h.style.setProperty(c,p[c])}i&&(h.style.fontFamily=i),h.innerHTML=u;var m=function(){r[d].appendChild(h)},_=this._insertCmdKey(o,e.rowLengths[d],d,r,m);_||m()}},e.prototype._insertCmdKey=function(e,t,a,s,r){if(2==a&&0==e){var n=document.createElement("div");n.classList.add("kb-key","kb-other"),n.innerHTML="Shift";var i=document.createAttribute("data-handler");return i.value="shift",n.attributes.setNamedItem(i),s[a].appendChild(n),r(),!0}if(2==a&&e==t-1){r();var o=document.createElement("div");o.classList.add("kb-key","kb-other","kb-flip"),o.innerHTML="&#8998;";var i=document.createAttribute("data-handler");return i.value="backspace",o.attributes.setNamedItem(i),s[a].appendChild(o),!0}return!1},e.prototype._setKeymap=function(e,t,a){this._populate(e,t,a),this._isNumberPad=t,this._isUpperCase=a,this._keyMap=e;var s=document.querySelector(".kb-key[data-handler='numpad']");s&&(s.innerHTML=this._keyMap.numpadText[this._isNumberPad?1:0])},e.prototype._getCursor=function(){var e,t;return e=window.getSelection(),e.getRangeAt&&e.rangeCount&&(t=e.getRangeAt(0)),t},e.prototype._setCursor=function(e){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)},e.prototype._isElementValid=function(e){return e===this._editorElement?!0:e.parentNode&&this._isElementValid(e.parentNode)},e.prototype._insertAtCursor=function(e,t,a){var s,r=this._getCursor();this._isElementValid(r.startContainer)&&(t?s=document.createTextNode(e):(s=document.createElement(e),s.innerHTML=a),r.insertNode(s),r.setStartAfter(s),this._setCursor(r),this._editorElement.normalize())},e.prototype._removeAtCursor=function(){var e=this._getCursor();this._isElementValid(e.startContainer)&&(e.collapsed&&e.startOffset>0&&e.setStart(e.startContainer,e.startOffset-1),e.deleteContents(),this._setCursor(e))},e.prototype._handleKey=function(e,t){switch(e){case"shift":this.SwitchCase();break;case"numpad":this.ToggleNumpad();break;case"switch":this.SwitchLanguage();break;case"enter":this._insertAtCursor("\n",!0,null);break;case"space":this._insertAtCursor("¬†",!0,null);break;case"backspace":this._removeAtCursor();break;default:this._insertAtCursor(e,!0,null),this._isUpperCase&&this.SwitchCase()}},e.prototype.SwitchCase=function(){this._isUpperCase?this._setKeymap(this._keyMap,!1,!1):this._setKeymap(this._keyMap,!1,!0)},e.prototype.ToggleNumpad=function(){this._isNumberPad?this._setKeymap(this._keyMap,!1,!1):this._setKeymap(this._keyMap,!0,!1)},e.prototype.SetLanguage=function(t){var a=e._keymaps.filter(function(e){return e.lang==t})[0];this._setKeymap(a,!1,!1)},e.prototype.SwitchLanguage=function(){this._languageIndex++,this._languageIndex==this._languages.length&&(this._languageIndex=0),this.SetLanguage(this._languages[this._languageIndex])},e.prototype.Hide=function(){this._baseElement.classList.add("kb-hidden")},e.prototype.Show=function(){this._baseElement.classList.remove("kb-hidden")},e.AddKeymap=function(e){this._keymaps.push(e)},e.RemoveKeymap=function(e){var t=this._keymaps.indexOf(e);t>-1&&this._keymaps.splice(t,1)},e.prototype._setPressedInterval=function(e,t,a){var s=this,r=e;clearInterval(this._pressedHandle),this._pressedHandle=setInterval(function(){s._isKeyPressed&&(r=Math.min(Math.abs(r-50),100),s._handleKey(t,a),s._setPressedInterval(r,t,a))},r)},e.prototype._populateLastRow=function(){var e=this._baseElement.querySelectorAll(".kb-row"),t=e[e.length-1],a=[{value:this._keyMap.numpadText[0],handler:"numpad",extraClass:null},{value:",",handler:null,extraClass:null},{value:"Space",handler:"space",extraClass:"kb-spacebar"},{value:".",handler:null,extraClass:null}],s={value:"üåêÔ∏é",handler:"switch",extraClass:null},r={value:"‚èé",handler:"enter",extraClass:"kb-enter"};this._addSwitchKey&&a.push(s),a.push(r);for(var n=0;n<a.length;n++){var i=a[n],o=document.createElement("div");o.classList.add("kb-key","kb-other"),i.extraClass&&o.classList.add(i.extraClass),o.innerText=i.value;var l=i.handler;if(l){var d=document.createAttribute("data-handler");d.value=l,o.attributes.setNamedItem(d)}t.appendChild(o)}},e._keymaps=[{name:"default",lang:"english",displayName:"English",direction:"ltr",keys:{lowercase:["q","w","e","r","t","y","u","i","o","p","a","s","d","f","g","h","j","k","l","z","x","c","v","b","n","m"],uppercase:["Q","W","E","R","T","Y","U","I","O","P","A","S","D","F","G","H","J","K","L","Z","X","C","V","B","N","M"],numbers:["1","2","3","4","5","6","7","8","9","0","@","#","$","%","&","-","+","(",")","*",'"',"'",":",";","!","?"]},numpadText:["?123","ABC"],rowLengths:[10,9,7],font:"Roboto",custom_styles:[]}],e}();